<!DOCTYPE html>

<html>

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

	<script src="js/raphael.2.1.0.min.js"></script>
	<script src="js/justgage.1.0.1.min.js"></script>
	<script src="js/jquery-1.8.2.min.js"></script>
	<script src="js/highcharts.js"></script>

	<script type='text/javascript'>

		$(document).ready(function(){

			var gauge = new JustGage({
				id: "gauge",
				value: 50,
				min: 0,
				max: 100,
				title: "Twitter Political Mood",
				label: "liberal:conservative",
				valueFontColor: "#ffffff",
				labelFontColor: "#ffffff",
				showMinMax: false,
				gaugeColor: "#ff3333",
				levelColors: ["#0066cc"],
				shadowOpacity: .4,
				shadowSize: 7,
				refreshAnimationTime: 400
			});

			var chart = new Highcharts.Chart({
				chart: {
					renderTo: 'chart',
					defaultSeriesType: 'line',
					zoomType: 'x',
					spacingRight: 20
				},
				colors: [
					'#4572A7', 
					'#AA4643'
				],
				title: { text: ' ' }, // empty string makes the spacing right
				plotOptions: {
					line: { 
						marker: { enabled: true }
					}
				},
				yAxis: {
					title: { text: null },
					plotLines: [{
						value: 0,
						width: 3,
						color: '#909090',
						zIndex: 1
					}]
				},
				xAxis: { 
					type: 'datetime',
					gridLineWidth: 1,
					gridLineDashStyle: 'longdash',
					dateTimeLabelFormats: {
						second: '%H:%M:%S',
					},
					tickInterval: 180000
				},
				tooltip: {
					shared: true,
					crosshairs: true
				},
				legend: {
					align: 'right',
					verticalAlign: 'top',
					y: 0,
					floating: true,
					borderWidth: 0
				},
				series: [{
					name: "Liberal",
					data: []
				}, {
					name: "Conservative",
					data: []
				}]
			});

			var graph_time = 0;
			var graph_points = 0;

			(function poll(){
				$.ajax({ url: "./out.txt", 
					success: function(data){
						gauge.refresh(data.gauge)
						$('#label').text(data.gauge+":"+(100-data.gauge));
						$('#sublabel').text(data.tweets+" tweets");

						if(data.time > graph_time + 18000) // add # of seconds between each update
						{
							graph_time = data.time;

							console.log(data.time);

							if(graph_points < 50) // # of points to fit on graph
							{
								graph_points++;
								chart.series[0].addPoint([graph_time, data.liberal], false, false);
								chart.series[1].addPoint([graph_time, data.conservative], false, false);
							}
							else
							{
								chart.series[0].addPoint([graph_time, data.liberal], false, true);
								chart.series[1].addPoint([graph_time, data.conservative], false, true);
							}

							chart.redraw();
						}
					},
					dataType: "json",
					complete: setTimeout(poll, 250), // limit the poll to 4 times per second
				timeout: 30000 });
			})();

		});

	</script>

	<style type='text/css'>
		body {
			font-family: 'Arial';
		}
		#gauge {
			width: 450px;
			height: 250px;
			margin: auto;
		}
		#label {
			width: 100px;
			position: absolute;
			left: 50%;
			top: 200px;
			margin-left: -50px;
			font-size: 38px;
			text-align: center;
			font-weight: bold;
		}
		#sublabel {
			width: 200px;
			position: absolute;
			left: 50%;
			top: 240px;
			margin-left: -100px;
			font-size: 18px;
			text-align: center;
			font-weight: bold;
			color: gray;
		}
		#chart {
			padding-top: 20px;
			height: 380px;
			padding-left: 10px;
			padding-right: 10px;
		}
		a.alchemy {
			position: absolute;
			top: 10px;
			right: 10px;
		}
		div.alchemy {
			position: absolute;
			top: 34px;
			right: 275px;
		}
	</style>

</head>

<body>
	<div id='gauge'></div>
	<div id='label'>50:50</div>
	<div id='sublabel'>0 tweets</div>

	<div class='alchemy'>Powered by</div>
	<a class='alchemy' href='http://www.alchemyapi.com'>
		<img src='http://www.alchemyapi.com/images/alchemyAPI.jpg' alt='alchemy-logo'/>
	</a>

	<div id="chart"></div>
</body>

</html>
